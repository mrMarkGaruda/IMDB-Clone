<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Series Details - IMDB Clone</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1><a href="index.html">IMDB Clone</a></h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="movies.html" class="nav-link">Movies</a></li>
                <li><a href="series.html" class="nav-link">TV Series</a></li>
                <li><a href="people.html" class="nav-link">People</a></li>
                <li><a href="search.html" class="nav-link">Search</a></li>
            </ul>
            <div class="search-box">
                <input type="text" id="quickSearch" placeholder="Quick search...">
                <button onclick="performQuickSearch()">üîç</button>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div id="seriesDetails">
            <!-- Series details will be loaded here -->
        </div>

        <!-- Seasons Overview -->
        <div class="form-container">
            <h3>Seasons</h3>
            <div id="seasonsOverview" class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Season</th>
                            <th>Episodes</th>
                            <th>Year</th>
                            <th>Average Rating</th>
                        </tr>
                    </thead>
                    <tbody id="seasonsTable">
                        <!-- Seasons will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Episodes -->
        <div class="form-container">
            <h3>Episodes</h3>
            <div class="form-group">
                <label for="seasonSelect">Select Season</label>
                <select id="seasonSelect" onchange="loadEpisodes()">
                    <option value="1">Season 1</option>
                </select>
            </div>
            <div id="episodesList" class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Episode</th>
                            <th>Title</th>
                            <th>Rating</th>
                            <th>Votes</th>
                        </tr>
                    </thead>
                    <tbody id="episodesTable">
                        <!-- Episodes will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cast -->
        <div class="form-container">
            <h3>Main Cast</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Actor</th>
                            <th>Character</th>
                            <th>Episodes</th>
                        </tr>
                    </thead>
                    <tbody id="castTable">
                        <!-- Cast will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Production Details -->
        <div class="form-container">
            <h3>Production Details</h3>
            <div id="productionDetails" class="detail-meta">
                <!-- Production details will be loaded here -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 IMDB Clone. Educational project.</p>
    </footer>

    <script src="js/database.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const seriesId = getUrlParameter('id');
            if (seriesId) {
                loadSeriesDetails(seriesId);
                loadSeasons(seriesId);
                loadSeriesCast(seriesId);
                loadProductionDetails(seriesId);
            } else {
                document.getElementById('seriesDetails').innerHTML = '<div class="error">Series ID not found</div>';
            }
        });

        async function loadSeriesDetails(seriesId) {
            try {
                showLoading('seriesDetails');
                const series = await db.getSeriesDetails(seriesId);
                
                document.getElementById('seriesDetails').innerHTML = `
                    <div class="detail-header">
                        <div class="detail-poster">
                            <img src="${series.poster}" alt="${series.title}">
                        </div>
                        <div class="detail-info">
                            <h1>${series.title}</h1>
                            <div class="detail-meta">
                                <div class="meta-item">
                                    <div class="meta-label">Years Active</div>
                                    <div class="meta-value">${formatYear(series.startYear, series.endYear)}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Status</div>
                                    <div class="meta-value">${series.endYear ? 'Ended' : 'Ongoing'}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Rating</div>
                                    <div class="meta-value">${formatRating(series.rating)}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Votes</div>
                                    <div class="meta-value">${series.votes.toLocaleString()}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Genres</div>
                                    <div class="meta-value">${series.genres}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Seasons</div>
                                    <div class="meta-value">${series.seasonCount || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="plot">
                                <h3>Plot</h3>
                                <p>${series.plot}</p>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading series details:', error);
                showError('seriesDetails', 'Error loading series details');
            }
        }

        async function loadSeasons(seriesId) {
            try {
                const seasons = await db.getSeriesSeasons(seriesId);
                const seasonsHtml = seasons.map(season => `
                    <tr>
                        <td>Season ${season.seasonNumber}</td>
                        <td>${season.episodeCount}</td>
                        <td>${season.year}</td>
                        <td>${formatRating(season.avgRating)}</td>
                    </tr>
                `).join('');
                
                document.getElementById('seasonsTable').innerHTML = seasonsHtml;
                
                // Populate season select
                const seasonOptions = seasons.map(season => 
                    `<option value="${season.seasonNumber}">Season ${season.seasonNumber}</option>`
                ).join('');
                document.getElementById('seasonSelect').innerHTML = seasonOptions;
                
                // Load first season episodes
                loadEpisodes();
                
            } catch (error) {
                console.error('Error loading seasons:', error);
            }
        }

        async function loadEpisodes() {
            try {
                const seriesId = getUrlParameter('id');
                const seasonNumber = document.getElementById('seasonSelect').value;
                const episodes = await db.getSeasonEpisodes(seriesId, seasonNumber);
                
                const episodesHtml = episodes.map(episode => `
                    <tr>
                        <td>${episode.episodeNumber}</td>
                        <td><a href="episode-details.html?id=${episode.id}">${episode.title}</a></td>
                        <td>${formatRating(episode.rating)}</td>
                        <td>${episode.votes.toLocaleString()}</td>
                    </tr>
                `).join('');
                
                document.getElementById('episodesTable').innerHTML = episodesHtml;
                
            } catch (error) {
                console.error('Error loading episodes:', error);
            }
        }

        async function loadSeriesCast(seriesId) {
            try {
                const cast = await db.getSeriesCast(seriesId);
                const castHtml = cast.map(actor => `
                    <tr>
                        <td><a href="person-details.html?id=${actor.id}">${actor.name}</a></td>
                        <td>${actor.character}</td>
                        <td>${actor.episodeCount}</td>
                    </tr>
                `).join('');
                
                document.getElementById('castTable').innerHTML = castHtml;
                
            } catch (error) {
                console.error('Error loading cast:', error);
            }
        }

        async function loadProductionDetails(seriesId) {
            try {
                const series = await db.getSeriesDetails(seriesId);
                const productionHtml = `
                    <div class="meta-item">
                        <div class="meta-label">Creators</div>
                        <div class="meta-value">${series.creators || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Production Companies</div>
                        <div class="meta-value">${series.productionCompanies || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Network</div>
                        <div class="meta-value">${series.network || 'N/A'}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Episode Runtime</div>
                        <div class="meta-value">${series.episodeRuntime || 'N/A'} minutes</div>
                    </div>
                `;
                document.getElementById('productionDetails').innerHTML = productionHtml;
            } catch (error) {
                console.error('Error loading production details:', error);
            }
        }
    </script>
</body>
</html>
